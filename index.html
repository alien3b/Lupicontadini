<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distribuzione Ruoli</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <h2>Scegli il tuo ruolo</h2>
        <button onclick="chooseRole('narrator')">Narratore</button>
        <button onclick="chooseRole('player')">Giocatore</button>
    </div>

    <div id="narratorOptions" style="display:none;">
        <h2>Come narratore, configura la partita</h2>
        <label for="numPlayers">Numero di giocatori:</label>
        <input type="number" id="numPlayers" min="1" max="15" />
        <br />
        <label for="role1">Contadini:</label>
        <input type="number" id="role1" min="0" />
        <br />
        <label for="role2">Lupi:</label>
        <input type="number" id="role2" min="0" />
        <br />
        <label for="role3">Veggenti:</label>
        <input type="number" id="role3" min="0" />
        <br />
        <button onclick="startGame()">Inizia il Gioco</button>
    </div>

    <div id="playerOptions" style="display:none;">
        <h2>Inserisci il tuo nome</h2>
        <input type="text" id="playerName" />
        <button onclick="joinGame()">Unisciti al Gioco</button>
    </div>

    <div id="gameResults" style="display:none;">
        <h2>Ruolo Assegnato</h2>
        <p id="assignedRole"></p>
    </div>

    <script>
        let players = [];
        let roles = [];
        let numPlayers = 0;
        let currentPlayer = null;

        function chooseRole(role) {
            if (role === 'narrator') {
                document.getElementById('narratorOptions').style.display = 'block';
                document.getElementById('app').style.display = 'none';
            } else {
                document.getElementById('playerOptions').style.display = 'block';
                document.getElementById('app').style.display = 'none';
                currentPlayer = 'player';
            }
        }

        function startGame() {
            numPlayers = document.getElementById('numPlayers').value;
            roles = [
                { name: "Contadino", quantity: parseInt(document.getElementById('role1').value) },
                { name: "Lupo", quantity: parseInt(document.getElementById('role2').value) },
                { name: "Veggente", quantity: parseInt(document.getElementById('role3').value) }
            ];
            document.getElementById('narratorOptions').style.display = 'none';
            document.getElementById('playerOptions').style.display = 'block';
        }

        function joinGame() {
            let name = document.getElementById('playerName').value;
            players.push(name);
            if (players.length === numPlayers) {
                assignRoles();
            }
        }

        function assignRoles() {
            let allRoles = [];
            roles.forEach(role => {
                for (let i = 0; i < role.quantity; i++) {
                    allRoles.push(role.name);
                }
            });

            // Shuffle roles randomly
            allRoles = shuffle(allRoles);

            let roleAssignments = {};
            players.forEach((player, index) => {
                roleAssignments[player] = allRoles[index];
            });

            if (currentPlayer === 'player') {
                document.getElementById('assignedRole').innerText = `Il tuo ruolo Ã¨: ${roleAssignments[players[players.length - 1]]}`;
                document.getElementById('gameResults').style.display = 'block';
            }

            if (currentPlayer === 'narrator') {
                console.log(roleAssignments); // For the narrator to see all assignments
            }
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>